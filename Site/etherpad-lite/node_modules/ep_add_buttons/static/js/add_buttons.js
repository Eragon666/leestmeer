/*** 
*
* Most of the logic for task lists are done here
*
*/

// get api
//api = require('etherpad-lite-client');

//var _, $, jQuery;
//var $ = require('ep_etherpad-lite/static/js/rjquery').$;


if(typeof exports == 'undefined'){
  	var exports = this['mymodule'] = {};
}

exports.add_buttons = {
  /*** Add button to the editbar and bind a listener ***/

	// Write the button to the dom
	init: function(){ 

		// make a sidebar with the button
		var buttonHTML = '<div id="sidebar"><div id="sidebarInner"><button class="acl-write" id="analyseButton"><a class="grouped-right" data-l10n-id="pad.toolbar.add_buttons.title" title="Task list Checkbox"><span class="buttonicon buttonicon-add_buttons"></span> Analyseer Tekst</a></button></div></div>';

		// append the sidebar and button to the pad content
		$('#editorcontainerbox').append(buttonHTML);

		// add an on click action to the button
		$('#analyseButton').click(function(){
			exports.add_buttons.onButton();
		});

	},	
	
	// execute this action on click	
	onButton: function(){ 
		
		console.log("Push my button baby, pad id:" + pad.getPadId());
		//console.log("Content is:");
		
		//
		var fullUrl = window.location.href + "/export/txt" ;
		
		console.log("url:" + fullUrl);
		
		
		jQuery.get(fullUrl, function(data) {
            var textContent = data;
			console.log("Content is:");
			console.log(data);
        });
		
		//console.log(fullUrl);
		
		
		//console.log(pad);
		
		//console.log(pad.ace.exportText());
		
		//console.log(etherpad.getText(pad.getPadId()));
		//padId = pad.getPadId();
		
		
		//exports.add_buttons.sendMessageToWriteTxtOfPadToFileSystem();
		// window.open(); Disabled for now.
				
	},
	
	// bullshit
	sendMessageToWriteTxtOfPadToFileSystem: function(){ // Tell file system to write the padId to the server filesytem
		var message = {};
		message.type = 'WRITE_TO_FILESYSTEM';
		message.padId = pad.getPadId();
		if(message){
			pad.collabClient.sendMessage(message);
		}
	}
}

exports.postAceInit = function(hook, context){
	console.log("postAceInit fired");
	exports.add_buttons.init();
	
	
};
